# @cherrystudio/ai-core

Cherry Studio AI Core æ˜¯ä¸€ä¸ªåŸºäº Vercel AI SDK çš„ç»Ÿä¸€ AI Provider æ¥å£åŒ…ï¼Œä¸º AI åº”ç”¨æä¾›å¼ºå¤§çš„æŠ½è±¡å±‚å’Œæ’ä»¶åŒ–æ¶æ„ã€‚

## âœ¨ æ ¸å¿ƒäº®ç‚¹

### ğŸ—ï¸ ä¼˜é›…çš„æ¶æ„è®¾è®¡

- **ç®€åŒ–åˆ†å±‚**ï¼š`models`ï¼ˆæ¨¡å‹å±‚ï¼‰â†’ `runtime`ï¼ˆè¿è¡Œæ—¶å±‚ï¼‰ï¼Œæ¸…æ™°çš„èŒè´£åˆ†ç¦»
- **å‡½æ•°å¼ä¼˜å…ˆ**ï¼šé¿å…è¿‡åº¦æŠ½è±¡ï¼Œæä¾›ç®€æ´ç›´è§‚çš„ API
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript æ”¯æŒï¼Œç›´æ¥å¤ç”¨ AI SDK ç±»å‹ç³»ç»Ÿ
- **æœ€å°åŒ…è£…**ï¼šç›´æ¥ä½¿ç”¨ AI SDK çš„æ¥å£ï¼Œé¿å…é‡å¤å®šä¹‰å’Œæ€§èƒ½æŸè€—

### ğŸ”Œ å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿ

- **ç”Ÿå‘½å‘¨æœŸé’©å­**ï¼šæ”¯æŒè¯·æ±‚å…¨ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•ç‚¹
- **æµè½¬æ¢æ”¯æŒ**ï¼šåŸºäº AI SDK çš„ `experimental_transform` å®ç°æµå¤„ç†
- **æ’ä»¶åˆ†ç±»**ï¼šFirstã€Sequentialã€Parallel ä¸‰ç§é’©å­ç±»å‹ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯
- **å†…ç½®æ’ä»¶**ï¼šwebSearchã€loggingã€toolUse ç­‰å¼€ç®±å³ç”¨çš„åŠŸèƒ½

### ğŸŒ ç»Ÿä¸€å¤š Provider æ¥å£

- **æ‰©å±•æ³¨å†Œ**ï¼šæ”¯æŒè‡ªå®šä¹‰ Provider æ³¨å†Œï¼Œæ— é™æ‰©å±•èƒ½åŠ›
- **é…ç½®ç»Ÿä¸€**ï¼šç»Ÿä¸€çš„é…ç½®æ¥å£ï¼Œç®€åŒ–å¤š Provider ç®¡ç†

### ğŸš€ å¤šç§ä½¿ç”¨æ–¹å¼

- **å‡½æ•°å¼è°ƒç”¨**ï¼šé€‚åˆç®€å•åœºæ™¯çš„ç›´æ¥å‡½æ•°è°ƒç”¨
- **æ‰§è¡Œå™¨å®ä¾‹**ï¼šé€‚åˆå¤æ‚åœºæ™¯çš„å¯å¤ç”¨æ‰§è¡Œå™¨
- **é™æ€å·¥å‚**ï¼šä¾¿æ·çš„é™æ€åˆ›å»ºæ–¹æ³•
- **åŸç”Ÿå…¼å®¹**ï¼šå®Œå…¨å…¼å®¹ AI SDK åŸç”Ÿ Provider Registry

### ğŸ”® é¢å‘æœªæ¥

- **Agent å°±ç»ª**ï¼šä¸º OpenAI Agents SDK é›†æˆé¢„ç•™æ¶æ„ç©ºé—´
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šç‹¬ç«‹åŒ…ç»“æ„ï¼Œæ”¯æŒè·¨é¡¹ç›®å¤ç”¨
- **æ¸è¿›å¼è¿ç§»**ï¼šå¯ä»¥é€æ­¥ä»ç°æœ‰ AI SDK ä»£ç è¿ç§»

## ç‰¹æ€§

- ğŸš€ ç»Ÿä¸€çš„ AI Provider æ¥å£
- ğŸ”„ åŠ¨æ€å¯¼å…¥æ”¯æŒ
- ğŸ› ï¸ TypeScript æ”¯æŒ
- ğŸ“¦ å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿ
- ğŸŒ å†…ç½®webSearch(Openai,Google,Anthropic,xAI)
- ğŸ¯ å¤šç§ä½¿ç”¨æ¨¡å¼ï¼ˆå‡½æ•°å¼/å®ä¾‹å¼/é™æ€å·¥å‚ï¼‰
- ğŸ”Œ å¯æ‰©å±•çš„ Provider æ³¨å†Œç³»ç»Ÿ
- ğŸ§© å®Œæ•´çš„ä¸­é—´ä»¶æ”¯æŒ
- ğŸ“Š æ’ä»¶ç»Ÿè®¡å’Œè°ƒè¯•åŠŸèƒ½

## æ”¯æŒçš„ Providers

åŸºäº [AI SDK å®˜æ–¹æ”¯æŒçš„ providers](https://ai-sdk.dev/providers/ai-sdk-providers)ï¼š

**æ ¸å¿ƒ Providersï¼ˆå†…ç½®æ”¯æŒï¼‰:**

- OpenAI
- Anthropic
- Google Generative AI
- OpenAI-Compatible
- xAI (Grok)
- Azure OpenAI
- DeepSeek

**æ‰©å±• Providersï¼ˆé€šè¿‡æ³¨å†ŒAPIæ”¯æŒï¼‰:**

- Google Vertex AI
- ...
- è‡ªå®šä¹‰ Provider

## å®‰è£…

```bash
npm install @cherrystudio/ai-core ai @ai-sdk/google @ai-sdk/openai
```

### React Native

å¦‚æœä½ åœ¨ React Native é¡¹ç›®ä¸­ä½¿ç”¨æ­¤åŒ…ï¼Œéœ€è¦åœ¨ `metro.config.js` ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```javascript
// metro.config.js
const { getDefaultConfig } = require('expo/metro-config')

const config = getDefaultConfig(__dirname)

// æ·»åŠ å¯¹ @cherrystudio/ai-core çš„æ”¯æŒ
config.resolver.resolverMainFields = ['react-native', 'browser', 'main']
config.resolver.platforms = ['ios', 'android', 'native', 'web']

module.exports = config
```

è¿˜éœ€è¦å®‰è£…ä½ è¦ä½¿ç”¨çš„ AI SDK provider:

```bash
npm install @ai-sdk/openai @ai-sdk/anthropic @ai-sdk/google
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```typescript
import { AiCore } from '@cherrystudio/ai-core'

// åˆ›å»º OpenAI executor
const executor = AiCore.create('openai', {
  apiKey: 'your-api-key'
})

// æµå¼ç”Ÿæˆ
const result = await executor.streamText('gpt-4', {
  messages: [{ role: 'user', content: 'Hello!' }]
})

// éæµå¼ç”Ÿæˆ
const response = await executor.generateText('gpt-4', {
  messages: [{ role: 'user', content: 'Hello!' }]
})
```

### ä¾¿æ·å‡½æ•°

```typescript
import { createOpenAIExecutor } from '@cherrystudio/ai-core'

// å¿«é€Ÿåˆ›å»º OpenAI executor
const executor = createOpenAIExecutor({
  apiKey: 'your-api-key'
})

// ä½¿ç”¨ executor
const result = await executor.streamText('gpt-4', {
  messages: [{ role: 'user', content: 'Hello!' }]
})
```

### å¤š Provider æ”¯æŒ

```typescript
import { AiCore } from '@cherrystudio/ai-core'

// æ”¯æŒå¤šç§ AI providers
const openaiExecutor = AiCore.create('openai', { apiKey: 'openai-key' })
const anthropicExecutor = AiCore.create('anthropic', { apiKey: 'anthropic-key' })
const googleExecutor = AiCore.create('google', { apiKey: 'google-key' })
const xaiExecutor = AiCore.create('xai', { apiKey: 'xai-key' })
```

### æ‰©å±• Provider æ³¨å†Œ

å¯¹äºéå†…ç½®çš„ providersï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œ API æ‰©å±•æ”¯æŒï¼š

```typescript
import { registerProvider, AiCore } from '@cherrystudio/ai-core'

// æ–¹å¼ä¸€ï¼šå¯¼å…¥å¹¶æ³¨å†Œç¬¬ä¸‰æ–¹ provider
import { createGroq } from '@ai-sdk/groq'

registerProvider({
  id: 'groq',
  name: 'Groq',
  creator: createGroq,
  supportsImageGeneration: false
})

// ç°åœ¨å¯ä»¥ä½¿ç”¨ Groq
const groqExecutor = AiCore.create('groq', { apiKey: 'groq-key' })

// æ–¹å¼äºŒï¼šåŠ¨æ€å¯¼å…¥æ–¹å¼æ³¨å†Œ
registerProvider({
  id: 'mistral',
  name: 'Mistral AI',
  import: () => import('@ai-sdk/mistral'),
  creatorFunctionName: 'createMistral'
})

const mistralExecutor = AiCore.create('mistral', { apiKey: 'mistral-key' })
```

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

AI Core æä¾›äº†å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼Œæ”¯æŒè¯·æ±‚å…¨ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•ã€‚

### å†…ç½®æ’ä»¶

#### webSearchPlugin - ç½‘ç»œæœç´¢æ’ä»¶

ä¸ºä¸åŒ AI Provider æä¾›ç»Ÿä¸€çš„ç½‘ç»œæœç´¢èƒ½åŠ›ï¼š

```typescript
import { webSearchPlugin } from '@cherrystudio/ai-core/built-in/plugins'

const executor = AiCore.create('openai', { apiKey: 'your-key' }, [
  webSearchPlugin({
    openai: {
      /* OpenAI æœç´¢é…ç½® */
    },
    anthropic: { maxUses: 5 },
    google: {
      /* Google æœç´¢é…ç½® */
    },
    xai: {
      mode: 'on',
      returnCitations: true,
      maxSearchResults: 5,
      sources: [{ type: 'web' }, { type: 'x' }, { type: 'news' }]
    }
  })
])
```

#### loggingPlugin - æ—¥å¿—æ’ä»¶

æä¾›è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—è®°å½•ï¼š

```typescript
import { createLoggingPlugin } from '@cherrystudio/ai-core/built-in/plugins'

const executor = AiCore.create('openai', { apiKey: 'your-key' }, [
  createLoggingPlugin({
    logLevel: 'info',
    includeParams: true,
    includeResult: false
  })
])
```

#### promptToolUsePlugin - æç¤ºå·¥å…·ä½¿ç”¨æ’ä»¶

ä¸ºä¸æ”¯æŒåŸç”Ÿ Function Call çš„æ¨¡å‹æä¾› prompt æ–¹å¼çš„å·¥å…·è°ƒç”¨ï¼š

```typescript
import { createPromptToolUsePlugin } from '@cherrystudio/ai-core/built-in/plugins'

// å¯¹äºä¸æ”¯æŒ function call çš„æ¨¡å‹
const executor = AiCore.create(
  'providerId',
  {
    apiKey: 'your-key',
    baseURL: 'https://your-model-endpoint'
  },
  [
    createPromptToolUsePlugin({
      enabled: true,
      // å¯é€‰ï¼šè‡ªå®šä¹‰ç³»ç»Ÿæç¤ºç¬¦æ„å»º
      buildSystemPrompt: (userPrompt, tools) => {
        return `${userPrompt}\n\nAvailable tools: ${Object.keys(tools).join(', ')}`
      }
    })
  ]
)
```

### è‡ªå®šä¹‰æ’ä»¶

åˆ›å»ºè‡ªå®šä¹‰æ’ä»¶éå¸¸ç®€å•ï¼š

```typescript
import { definePlugin } from '@cherrystudio/ai-core'

const customPlugin = definePlugin({
  name: 'custom-plugin',
  enforce: 'pre', // 'pre' | 'post' | undefined

  // åœ¨è¯·æ±‚å¼€å§‹æ—¶è®°å½•æ—¥å¿—
  onRequestStart: async (context) => {
    console.log(`Starting request for model: ${context.modelId}`)
  },

  // è½¬æ¢è¯·æ±‚å‚æ•°
  transformParams: async (params, context) => {
    // æ·»åŠ è‡ªå®šä¹‰ç³»ç»Ÿæ¶ˆæ¯
    if (params.messages) {
      params.messages.unshift({
        role: 'system',
        content: 'You are a helpful assistant.'
      })
    }
    return params
  },

  // å¤„ç†å“åº”ç»“æœ
  transformResult: async (result, context) => {
    // æ·»åŠ å…ƒæ•°æ®
    if (result.text) {
      result.metadata = {
        processedAt: new Date().toISOString(),
        modelId: context.modelId
      }
    }
    return result
  }
})

// ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶
const executor = AiCore.create('openai', { apiKey: 'your-key' }, [customPlugin])
```

### ä½¿ç”¨ AI SDK åŸç”Ÿ Provider æ³¨å†Œè¡¨

> https://ai-sdk.dev/docs/reference/ai-sdk-core/provider-registry

é™¤äº†ä½¿ç”¨å†…å»ºçš„ provider ç®¡ç†ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ AI SDK åŸç”Ÿçš„ `createProviderRegistry` æ¥æ„å»ºè‡ªå·±çš„ provider æ³¨å†Œè¡¨ã€‚

#### åŸºæœ¬ç”¨æ³•ç¤ºä¾‹

```typescript
import { createClient } from '@cherrystudio/ai-core'
import { createProviderRegistry } from 'ai'
import { createOpenAI } from '@ai-sdk/openai'
import { anthropic } from '@ai-sdk/anthropic'

// 1. åˆ›å»º AI SDK åŸç”Ÿæ³¨å†Œè¡¨
export const registry = createProviderRegistry({
  // register provider with prefix and default setup:
  anthropic,

  // register provider with prefix and custom setup:
  openai: createOpenAI({
    apiKey: process.env.OPENAI_API_KEY
  })
})

// 2. åˆ›å»ºclient,'openai'å¯ä»¥ä¼ ç©ºæˆ–è€…ä¼ providerId(å†…å»ºçš„provider)
const client = PluginEnabledAiClient.create('openai', {
  apiKey: process.env.OPENAI_API_KEY
})

// 3. æ–¹å¼1ï¼šä½¿ç”¨å†…å»ºé€»è¾‘ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
const result1 = await client.streamText('gpt-4', {
  messages: [{ role: 'user', content: 'Hello with built-in logic!' }]
})

// 4. æ–¹å¼2ï¼šä½¿ç”¨è‡ªå®šä¹‰æ³¨å†Œè¡¨ï¼ˆçµæ´»æ–¹å¼ï¼‰
const result2 = await client.streamText({
  model: registry.languageModel('openai:gpt-4'),
  messages: [{ role: 'user', content: 'Hello with custom registry!' }]
})

// 5. æ”¯æŒçš„é‡è½½æ–¹æ³•
await client.generateObject({
  model: registry.languageModel('openai:gpt-4'),
  schema: z.object({ name: z.string() }),
  messages: [{ role: 'user', content: 'Generate a user' }]
})

await client.streamObject({
  model: registry.languageModel('anthropic:claude-3-opus-20240229'),
  schema: z.object({ items: z.array(z.string()) }),
  messages: [{ role: 'user', content: 'Generate a list' }]
})
```

#### ä¸æ’ä»¶ç³»ç»Ÿé…åˆä½¿ç”¨

æ›´å¼ºå¤§çš„æ˜¯ï¼Œä½ è¿˜å¯ä»¥å°†è‡ªå®šä¹‰æ³¨å†Œè¡¨ä¸ Cherry Studio çš„æ’ä»¶ç³»ç»Ÿç»“åˆä½¿ç”¨ï¼š

```typescript
import { PluginEnabledAiClient } from '@cherrystudio/ai-core'
import { createProviderRegistry } from 'ai'
import { createOpenAI } from '@ai-sdk/openai'
import { anthropic } from '@ai-sdk/anthropic'

// 1. åˆ›å»ºå¸¦æ’ä»¶çš„å®¢æˆ·ç«¯
const client = PluginEnabledAiClient.create(
  'openai',
  {
    apiKey: process.env.OPENAI_API_KEY
  },
  [LoggingPlugin, RetryPlugin]
)

// 2. åˆ›å»ºè‡ªå®šä¹‰æ³¨å†Œè¡¨
const registry = createProviderRegistry({
  openai: createOpenAI({ apiKey: process.env.OPENAI_API_KEY }),
  anthropic: anthropic({ apiKey: process.env.ANTHROPIC_API_KEY })
})

// 3. æ–¹å¼1ï¼šä½¿ç”¨å†…å»ºé€»è¾‘ + å®Œæ•´æ’ä»¶ç³»ç»Ÿ
await client.streamText('gpt-4', {
  messages: [{ role: 'user', content: 'Hello with plugins!' }]
})

// 4. æ–¹å¼2ï¼šä½¿ç”¨è‡ªå®šä¹‰æ³¨å†Œè¡¨ + æœ‰é™æ’ä»¶æ”¯æŒ
await client.streamText({
  model: registry.languageModel('anthropic:claude-3-opus-20240229'),
  messages: [{ role: 'user', content: 'Hello from Claude!' }]
})

// 5. æ”¯æŒçš„æ–¹æ³•
await client.generateObject({
  model: registry.languageModel('openai:gpt-4'),
  schema: z.object({ name: z.string() }),
  messages: [{ role: 'user', content: 'Generate a user' }]
})

await client.streamObject({
  model: registry.languageModel('openai:gpt-4'),
  schema: z.object({ items: z.array(z.string()) }),
  messages: [{ role: 'user', content: 'Generate a list' }]
})
```

#### æ··åˆä½¿ç”¨çš„ä¼˜åŠ¿

- **çµæ´»æ€§**ï¼šå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä½¿ç”¨å†…å»ºé€»è¾‘æˆ–è‡ªå®šä¹‰æ³¨å†Œè¡¨
- **å…¼å®¹æ€§**ï¼šå®Œå…¨å…¼å®¹ AI SDK çš„ `createProviderRegistry` API
- **æ¸è¿›å¼**ï¼šå¯ä»¥é€æ­¥è¿ç§»ç°æœ‰ä»£ç ï¼Œæ— éœ€ä¸€æ¬¡æ€§é‡æ„
- **æ’ä»¶æ”¯æŒ**ï¼šè‡ªå®šä¹‰æ³¨å†Œè¡¨ä»å¯äº«å—æ’ä»¶ç³»ç»Ÿçš„éƒ¨åˆ†åŠŸèƒ½
- **æœ€ä½³å®è·µ**ï¼šç»“åˆä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼Œæ—¢æœ‰åŠ¨æ€åŠ è½½çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œåˆæœ‰ç»Ÿä¸€æ³¨å†Œè¡¨çš„ä¾¿åˆ©æ€§

## ğŸ“š ç›¸å…³èµ„æº

- [Vercel AI SDK æ–‡æ¡£](https://ai-sdk.dev/)
- [Cherry Studio é¡¹ç›®](https://github.com/CherryHQ/cherry-studio)
- [AI SDK Providers](https://ai-sdk.dev/providers/ai-sdk-providers)

## æœªæ¥ç‰ˆæœ¬

- ğŸ”® å¤š Agent ç¼–æ’
- ğŸ”® å¯è§†åŒ–æ’ä»¶é…ç½®
- ğŸ”® å®æ—¶ç›‘æ§å’Œåˆ†æ
- ğŸ”® äº‘ç«¯æ’ä»¶åŒæ­¥

## ğŸ“„ License

MIT License - è¯¦è§ [LICENSE](https://github.com/CherryHQ/cherry-studio/blob/main/LICENSE) æ–‡ä»¶

---

**Cherry Studio AI Core** - è®© AI å¼€å‘æ›´ç®€å•ã€æ›´å¼ºå¤§ã€æ›´çµæ´» ğŸš€
